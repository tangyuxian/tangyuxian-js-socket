!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).Socket=n()}(this,(function(){"use strict";function e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function n(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}return function(){function o(n,i){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),t(this,"socketUrl",void 0),t(this,"option",void 0),t(this,"websocket",void 0),t(this,"sendPingInterval",void 0),t(this,"reconnectInterval",void 0),t(this,"activeLink",void 0),t(this,"reconnectNum",0),this.socketUrl=n,this.option=function(n){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{};o%2?e(Object(i),!0).forEach((function(e){t(n,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))}))}return n}({onOpenAutoSendMsg:"",heartTime:5e3,heartMsg:"ping",isReconnect:!0,reconnectTime:5e3,reconnectCount:-1,openCallback:null,closeCallback:null,messageCallback:null,errorCallback:null,debug:!1},i),this.websocket=null,this.sendPingInterval=null,this.reconnectInterval=null,this.activeLink=!0,this.reconnectNum=0,this.init()}var i,c,s;return i=o,(c=[{key:"init",value:function(){if(!("WebSocket"in window))throw new Error("当前浏览器不支持");if(!this.socketUrl)throw new Error("请配置连接地址");this.websocket=null,this.websocket=new window.WebSocket(this.socketUrl),this.websocketOnOpen(null),this.websocketOnMessage(null),this.websocketOnError(null),this.websocketOnClose(null)}},{key:"websocketOnOpen",value:function(e){var n=this;this.websocket instanceof window.WebSocket&&(this.websocket.onopen=function(t){n.option.debug&&console.log("%c websocket链接成功","color:green"),n.sendPing(n.option.heartTime,n.option.heartMsg),n.option.onOpenAutoSendMsg&&n.send(n.option.onOpenAutoSendMsg),"function"==typeof e?e(t):"function"==typeof n.option.openCallback&&n.option.openCallback(t)})}},{key:"send",value:function(e){this.websocket instanceof window.WebSocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(e)}},{key:"websocketOnMessage",value:function(e){var n=this;this.websocket instanceof window.WebSocket&&(this.websocket.onmessage=function(t){"function"==typeof e?e(t.data):"function"==typeof n.option.messageCallback&&n.option.messageCallback(t.data)})}},{key:"websocketOnError",value:function(e){var n=this;this.websocket instanceof window.WebSocket&&(this.websocket.onerror=function(t){n.option.debug&&console.error("连接发生错误",t),"function"==typeof e?e(t):"function"==typeof n.option.errorCallback&&n.option.errorCallback(t)})}},{key:"websocketOnClose",value:function(e){var n=this;this.websocket instanceof window.WebSocket&&(this.websocket.onclose=function(t){n.option.debug&&console.warn("socket连接关闭,关于原因:",t),clearInterval(n.sendPingInterval),clearInterval(n.reconnectInterval),n.activeLink&&n.option.isReconnect?n.onReconnect():(n.activeLink=!1,n.option.debug&&console.log("%c websocket链接完全关闭","color:green")),"function"==typeof e?e(t):"function"==typeof n.option.closeCallback&&n.option.closeCallback(t)})}},{key:"onReconnect",value:function(){var e=this;this.option.debug&&console.warn("非正常关闭,".concat(this.option.reconnectTime,"毫秒后触发重连事件")),-1===this.option.reconnectCount||this.option.reconnectCount>this.reconnectNum?this.reconnectInterval=setTimeout((function(){e.reconnectNum++,e.option.debug&&console.warn("正在准备第".concat(e.reconnectNum,"次重连")),e.init()}),this.option.reconnectTime):(this.activeLink=!1,this.option.debug&&console.warn("已重连".concat(this.reconnectNum,"次仍然没有响应,取消重连")),clearInterval(this.reconnectInterval))}},{key:"removeSocket",value:function(){this.activeLink=!1,this.websocket instanceof window.WebSocket&&this.websocket.close(1e3)}},{key:"sendPing",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ping";clearInterval(this.sendPingInterval),-1!==n&&(this.send(t),this.sendPingInterval=setInterval((function(){e.send(t)}),n))}},{key:"getWebsocket",value:function(){return this.websocket}},{key:"getActiveLink",value:function(){return this.activeLink}}])&&n(i.prototype,c),s&&n(i,s),o}()}));
